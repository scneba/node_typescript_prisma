## Node.js/TypeScript/MongoDB Base Backend

This is a starter project which enables Startups get up and running with node.js and prisma ORM in no time. It provides an auth(user/role/permission) system, testing, dockerization, and CI/CD. It is built with Express.js framework, TypeScript, Prisma ORM, PostgreSQL, and tested with Jest and Postman.
This is usually a first and difficult step for any startup and this project will get you up and running immediately.

### Technologies and Resources

- Node.js
- Express.js
- Prisma ORM
- TypeScript
- PostgreSQL
- Postman
- Jest
- Docker/Docker Compose
- Git

### Setup

1. Download and install git from [here](https://git-scm.com/downloads). This should also install git bash which can be opened from the windows start menu.

- Install postman and create an account. Download from [here](https://www.postman.com/downloads/).

2. Download and Install postgres 14.8 [here](https://www.enterprisedb.com/downloads/postgres-postgresql-downloads). This should come with postgresql and should automatically run after install on poNrt 5432. Make sure to take note of your passwords, there should be a PgAdmin password and the default user password. After install, open git bash and run the following commands to check if postgres is running on same port

- Start PgAdmin from windows start menu and input your passwords.
- Create a database called `nodeprisma` with the user postgres.

3. Install Node.js. Download your variant from [here](https://nodejs.org/en/download/)

- After install, open git bash or a terminal and type the command below to see if you get the help page

```
npm -h
```

4. Clone this repository

```
git clone https://github.com/scneba/node_typescript_prisma
```

5. open git bash on the root folder and run

```
npm install
```

6. Make a copy of the .env.example and rename it to .env
7. Update the connection string (DATABASE_URL) on to the postgres connection string

```
DATABASE_URL="postgresql://postgres:PASSWORD@localhost:5432/nodeprisma?schema=public"
```

8. Run `npm run dev` on the root folder to start the project.

9. Install postman and create an account. Download from [here](https://www.postman.com/downloads/).

## Development

### File structure

**--prisma**: Prisma schemas, migrations and seeds \
&nbsp;&nbsp;&nbsp;**--migrations.ts** All migrations generated by prisma from schema changes.\
&nbsp;&nbsp;&nbsp;**--schema.prisma** Prisma schemas.\
&nbsp;&nbsp;&nbsp;**--seed.ts** All seeds for prisma schema.\
**--postman**: Postman collection \
**&nbsp;&nbsp;&nbsp;--nodebase.postman_collection.json** postman collection to import and run on postman. \
**--src** All source code should be added in here. \
\***\*&nbsp;&nbsp; --controllers** MVC controllers - all core logic for endpoint control is added here. Each folder name ends in "ing" and represents related subcontroller logic. Each subcontroller has the following files \
&nbsp;&nbsp;&nbsp;**--errors.ts** All subcontroller errors.\
&nbsp;&nbsp;&nbsp;**--service.ts** All the logic for the subcontroller should be added here. \
&nbsp;&nbsp;&nbsp;**--validate.ts** All validation logic for controller \
&nbsp;&nbsp;&nbsp;**--service.test.ts** All tests for this subcontroller should be added here. See the documentation for jest testing [here](https://jestjs.io/docs/getting-started). \
**--data** all database access methods are added here. \
**--routes** All routes contained in the repo. \
**--utils** Any reusable typescript code \
**--index.ts** entry point of application. \

### Run Seeds

- Run this command in the root folder to run the seeds on the database

```
 npx prisma db seed
```

### Testing

Ideally, all core logic in controllers should be tested. To test particular sub controller/file, use the testPathPattern eg.

```
npm test -- --testPathPattern "registering/"
```

This will run all tests in the registering/ path.

### Postman

Import the collection at Postman/nodebase.postman_collection.json into postman.
Update the domain variable in postman
![image](./images/postman.jpg)

- Start project with ts-node

```
npm run dev
```

- Run postman collection and make sure all tests pass
  ![image](./images/postman_all_tests.jpg)

Congratulations, you are ready to start development with this base project.
